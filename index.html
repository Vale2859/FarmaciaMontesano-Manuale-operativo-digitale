<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Portale Professionale – Farmacia Montesano</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ================= LOGIN FULLSCREEN ================= -->
  <div id="auth" class="auth-fullscreen">

    <!-- sfondo a tutto schermo (foto farmacia-bg.jpg) -->
    <div class="auth-bg"></div>

    <!-- velo scuro sopra la foto -->
    <div class="auth-overlay"></div>

    <!-- box centrale con login / registrazione -->
    <div class="auth-center-box">

      <div class="auth-logo-wrapper">
        <img src="logo-farmacia-montesano.png" alt="Farmacia Montesano" class="auth-logo-large" />
        <h1 class="auth-title">Farmacia Montesano</h1>
        <p class="auth-subtitle">Portale professionale interno</p>
      </div>

      <!-- BOX LOGIN -->
      <div id="login-box">
        <label>Email</label>
        <input type="email" id="login-email" placeholder="nome@farmaciamontesano.it" />

        <label>Password</label>
        <input type="password" id="login-password" placeholder="Password" />

        <button class="btn-primary" onclick="login()">Entra</button>

        <p class="small-text">
          Non hai un account?
          <a href="#" onclick="showRegister(event)">Richiedi registrazione</a>
        </p>
        <p class="small-text">
          Password dimenticata? <br />
          <strong>Solo il titolare può reimpostarla dall'area Admin.</strong>
        </p>
      </div>

      <!-- BOX REGISTRAZIONE -->
      <div id="register-box" class="hidden">
        <h2>Nuovo dipendente</h2>

        <label>Nome e cognome</label>
        <input type="text" id="reg-name" placeholder="Es. Daniela Andrisani" />

        <label>Email aziendale</label>
        <input type="email" id="reg-email" placeholder="Es. daniela@farmaciamontesano.it" />

        <label>Password iniziale</label>
        <input type="password" id="reg-password" placeholder="Crea una password" />

        <button class="btn-primary" onclick="registerUser()">Crea account</button>

        <p class="small-text">
          Hai già un account?
          <a href="#" onclick="showLogin(event)">Torna al login</a>
        </p>
      </div>

      <p id="auth-error" class="error-text hidden"></p>

      <p class="small-text muted-center" style="margin-top: 12px;">
        L'utilizzo del portale è riservato al personale autorizzato della Farmacia Montesano.
      </p>
    </div>
  </div>

  <!-- ================= PORTALE INTERNO ================= -->
  <div id="portal" class="portal hidden">

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-left">
        <img src="logo-farmacia-montesano.png" alt="Farmacia Montesano" class="topbar-logo-img" />
        <div>
          <div class="topbar-title">Farmacia Montesano</div>
          <div class="topbar-subtitle">Portale interno operativo</div>
        </div>
      </div>

      <div class="topbar-user">
        <div class="user-pill">
          <span id="user-name-display">Utente</span>
          <span id="user-role-display" class="role-badge">Ruolo</span>
        </div>
        <button class="btn-outline" onclick="logout()">Logout</button>
      </div>
    </header>

    <!-- LAYOUT PRINCIPALE -->
    <div class="layout">

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="nav-label">Navigazione</div>
        <button id="nav-home" class="nav-btn active" onclick="showSection('home', this)">Dashboard</button>
        <button id="nav-procedure" class="nav-btn" onclick="showSection('procedure', this)">Procedure</button>
        <button id="nav-comunicazioni" class="nav-btn" onclick="showSection('comunicazioni', this)">Comunicazioni</button>
        <button id="nav-leave" class="nav-btn" onclick="showSection('leave', this)">Ferie &amp; permessi</button>
        <button id="nav-training" class="nav-btn" onclick="showSection('training', this)">Formazione</button>
        <button id="nav-personal" class="nav-btn" onclick="showSection('personal', this)">Area personale</button>
        <button id="nav-admin" class="nav-btn hidden" onclick="showSection('admin', this)">Area Admin</button>
      </aside>

      <!-- CONTENUTO -->
      <main class="main">

        <!-- ===== DASHBOARD ===== -->
        <section id="home" class="section visible">
          <div class="section-header">
            <h2 id="home-title">Benvenuto nel Portale</h2>
            <p class="subtitle">
              Qui trovi una panoramica rapida di tutto ciò che serve oggi in farmacia.
            </p>
          </div>

          <div class="home-grid">
            <!-- Avvisi del giorno -->
            <div class="card card-highlight">
              <div class="card-header-row">
                <h3>Avvisi del giorno</h3>
                <span class="tag subtle" id="home-daytag"></span>
              </div>
              <ul id="home-highlights" class="bullet-list"></ul>
            </div>

            <!-- Procedure veloci -->
            <div class="card">
              <h3>Procedure rapide di cassa</h3>
              <p>Le procedure più usate, sempre a portata di click.</p>
              <div id="home-quick-proc" class="quick-links"></div>
            </div>

            <!-- Logistica -->
            <div class="card">
              <h3>Logistica &amp; scadenze</h3>
              <ul id="home-logistics-summary" class="bullet-list"></ul>
            </div>
          </div>

          <div class="cards-grid">
            <!-- Comunicazioni veloci -->
            <div class="card">
              <h3>Ultime comunicazioni interne</h3>
              <div id="message-list" class="list"></div>
            </div>

            <!-- Riepilogo ferie -->
            <div class="card">
              <h3>Le tue richieste ferie / permessi</h3>
              <p class="subtitle">Riepilogo rapido delle tue richieste recenti.</p>
              <table class="table-simple" id="home-leave-table">
                <thead>
                  <tr>
                    <th>Data richiesta</th>
                    <th>Tipo</th>
                    <th>Periodo</th>
                    <th>Stato</th>
                  </tr>
                </thead>
                <tbody id="home-leave-body">
                  <!-- (non obbligatorio: lo script usa la tabella principale nella sezione Ferie) -->
                </tbody>
              </table>
            </div>

            <!-- Area personale -->
            <div class="card">
              <h3>Promemoria personale</h3>
              <p>Vai nella sezione <strong>Area personale</strong> per annotare appunti solo tuoi.</p>
            </div>
          </div>
        </section>

        <!-- ===== PROCEDURE ===== -->
        <section id="procedure" class="section">
          <div class="section-header">
            <h2>Procedure interne</h2>
            <p class="subtitle">
              Tutte le procedure di cassa, POS, anticipi, magazzino, turni, ecc.
            </p>
          </div>

          <div class="proc-layout">
            <div class="proc-categories" id="proc-categories">
              <!-- categorie generate dallo script -->
            </div>

            <div class="proc-content">
              <div id="proc-list" class="list"></div>
            </div>
          </div>
        </section>

        <!-- ===== COMUNICAZIONI ===== -->
        <section id="comunicazioni" class="section">
          <div class="section-header">
            <h2>Comunicazioni interne</h2>
            <p class="subtitle">
              Messaggi, note importanti, aggiornamenti inviati dal titolare o dai responsabili.
            </p>
          </div>

          <div id="message-list-section" class="list">
            <!-- lo stesso contenuto di message-list home, riutilizzato -->
            <div id="message-list" class="list"></div>
          </div>
        </section>

        <!-- ===== FERIE & PERMESSI ===== -->
        <section id="leave" class="section">
          <div class="section-header">
            <h2>Ferie &amp; permessi</h2>
            <p class="subtitle">
              Invia una nuova richiesta e tieni traccia dello stato (in attesa, approvata, rifiutata).
            </p>
          </div>

          <div class="two-cols">
            <div class="card">
              <h3>Nuova richiesta</h3>

              <label>Tipo</label>
              <select id="leave-type">
                <option value="Ferie">Ferie</option>
                <option value="Permesso retribuito">Permesso retribuito</option>
                <option value="Permesso non retribuito">Permesso non retribuito</option>
                <option value="Malattia (segnalazione)">Malattia (segnalazione)</option>
              </select>

              <div class="field-row">
                <div class="field-flex">
                  <label>Data inizio</label>
                  <input type="date" id="leave-start" />
                </div>
                <div class="field-flex">
                  <label>Data fine (opzionale)</label>
                  <input type="date" id="leave-end" />
                </div>
              </div>

              <label>Note per il titolare (facoltative)</label>
              <textarea id="leave-note" rows="3"></textarea>

              <button class="btn-primary" style="margin-top: 10px;" onclick="sendLeaveRequest()">
                Invia richiesta
              </button>
            </div>

            <div class="card">
              <h3>Le tue richieste</h3>
              <table id="leave-table" class="table-simple">
                <thead>
                  <tr>
                    <th>Richiesta il</th>
                    <th>Tipo</th>
                    <th>Periodo</th>
                    <th>Stato</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- popolato da loadLeaveForUser -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ===== FORMAZIONE ===== -->
        <section id="training" class="section">
          <div class="section-header">
            <h2>Formazione &amp; aggiornamenti</h2>
            <p class="subtitle">
              Appunti sui corsi, ECM, nuovi prodotti e procedure aggiornate.
            </p>
          </div>

          <div class="two-cols">
            <div class="card">
              <h3>Moduli consigliati</h3>
              <ul id="training-list" class="bullet-list"></ul>
            </div>

            <div class="card">
              <h3>I tuoi appunti</h3>
              <textarea id="training-notes" rows="8"></textarea>
              <button class="btn-primary" style="margin-top: 8px;" onclick="saveTrainingNotes()">
                Salva appunti
              </button>
              <span id="training-saved" class="saved-label hidden">Salvato ✓</span>
            </div>
          </div>
        </section>

        <!-- ===== AREA PERSONALE ===== -->
        <section id="personal" class="section">
          <div class="section-header">
            <h2>Area personale privata</h2>
            <p class="subtitle">
              Solo tu puoi vedere queste note. Non sono visibili ad altri dipendenti.
            </p>
          </div>

          <div class="two-cols">
            <div class="card">
              <h3>Appunti personali</h3>
              <textarea id="personal-notes" rows="8"></textarea>
              <button class="btn-primary" style="margin-top: 8px;" onclick="savePersonalNotes()">
                Salva appunti
              </button>
              <span id="personal-notes-saved" class="saved-label hidden">Salvato ✓</span>
            </div>

            <div class="card">
              <h3>Promemoria documenti</h3>
              <p class="subtitle">
                Qui puoi segnarti documenti importanti (buste paga, contratti, attestati…) che conservi tu.
              </p>

              <label>Titolo documento</label>
              <input id="personal-doc-title" type="text" placeholder="Es. Busta paga marzo 2025" />

              <label>Descrizione / dove lo conservi</label>
              <input id="personal-doc-desc" type="text" placeholder="Es. Cartellina verde nel cassetto" />

              <button class="btn-primary" style="margin-top: 8px;" onclick="addPersonalDoc()">
                Aggiungi promemoria
              </button>

              <div id="personal-doc-list" class="list" style="margin-top: 10px;"></div>
            </div>
          </div>
        </section>

        <!-- ===== AREA ADMIN ===== -->
        <section id="admin" class="section">
          <div class="section-header">
            <h2>Area Admin (Titolare)</h2>
            <p class="subtitle">
              Gestione utenti, comunicazioni, procedure e approvazione ferie &amp; permessi.
            </p>
          </div>

          <div class="admin-grid">

            <!-- Gestione utenti -->
            <div class="card">
              <h3>Utenti e password</h3>
              <p class="subtitle">
                Vedi tutti gli account registrati. Solo l'admin può reimpostare le password.
              </p>
              <div id="admin-users" class="list"></div>
            </div>

            <!-- Comunicazioni + Procedure + Ferie -->
            <div class="card">
              <h3>Comunicazioni veloci</h3>

              <label>Destinatario</label>
              <select id="admin-msg-target">
                <option value="all">Tutti</option>
              </select>

              <label>Priorità</label>
              <select id="admin-msg-priority">
                <option value="normale">Normale</option>
                <option value="alta">Alta</option>
                <option value="urgente">Urgente</option>
              </select>

              <label>Titolo</label>
              <input id="admin-msg-title" type="text" />

              <label>Testo</label>
              <textarea id="admin-msg-body" rows="4"></textarea>

              <button class="btn-primary" style="margin-top: 8px;" onclick="adminSendMessage()">
                Invia comunicazione
              </button>

              <hr style="margin: 16px 0; border: none; border-top: 1px solid #e0e4ef" />

              <h3>Modifica procedure</h3>
              <label>Categoria</label>
              <input id="admin-proc-cat" type="text" placeholder="Es. Cassa, POS, Magazzino" />

              <label>Titolo procedura</label>
              <input id="admin-proc-title" type="text" />

              <label>Testo procedura</label>
              <textarea id="admin-proc-body" rows="4"></textarea>

              <button class="btn-primary" style="margin-top: 8px;" onclick="adminSaveProcedure()">
                Salva procedura
              </button>

              <div id="admin-proc-list" class="list" style="margin-top: 12px;"></div>

              <hr style="margin: 16px 0; border: none; border-top: 1px solid #e0e4ef" />

              <h3>Richieste ferie / permessi</h3>
              <div id="admin-leave-list" class="list"></div>
            </div>

          </div>
        </section>

      </main>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
