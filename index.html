<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Portale Farmacia Montesano</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- SCHERMATA LOGIN / REGISTRAZIONE -->
  <div id="auth-screen" class="auth-screen">
    <div class="auth-card">
      <h1 class="logo-title">Farmacia Montesano</h1>
      <h2>Accesso Dipendenti</h2>

      <!-- LOGIN -->
      <div id="login-box">
        <label>Email</label>
        <input type="email" id="login-email" placeholder="nome@farmaciamontesano.it" />

        <label>Password</label>
        <input type="password" id="login-password" placeholder="Password" />

        <button class="btn-primary" onclick="login()">Entra</button>

        <p class="small-text">
          Nuovo dipendente?
          <a href="#" onclick="showRegister()">Registrati</a>
        </p>
      </div>

      <!-- REGISTRAZIONE -->
      <div id="register-box" style="display: none;">
        <label>Nome e cognome</label>
        <input type="text" id="reg-name" placeholder="Es. Daniela Andrisani" />

        <label>Email</label>
        <input type="email" id="reg-email" placeholder="Email aziendale" />

        <label>Password</label>
        <input type="password" id="reg-password" placeholder="Crea una password" />

        <button class="btn-primary" onclick="register()">Crea account</button>

        <p class="small-text">
          Hai gi√† un account?
          <a href="#" onclick="showLogin()">Torna al login</a>
        </p>
      </div>

      <p id="auth-error" class="error-text" style="display:none;"></p>
    </div>
  </div>

  <!-- PORTALE INTERNO (VISIBILE SOLO DOPO LOGIN) -->
  <div id="portal" class="portal hidden">
    <header class="topbar">
      <div>
        <span class="topbar-logo">Farmacia Montesano ‚Äì Portale Interno</span>
      </div>
      <div class="topbar-user">
        <span id="user-name-display"></span>
        <button class="btn-outline" onclick="logout()">Logout</button>
      </div>
    </header>

    <div class="layout">
      <!-- MENU LATERALE -->
      <aside class="sidebar">
        <button class="nav-btn active" id="nav-home" onclick="showSection('home', this)">üè† Dashboard</button>
        <button class="nav-btn" id="nav-procedures" onclick="showSection('procedures', this)">üìÑ Procedure</button>
        <button class="nav-btn" id="nav-messages" onclick="showSection('messages', this)">üì£ Comunicazioni</button>
      </aside>

      <!-- CONTENUTO PRINCIPALE -->
      <main class="main">
        <!-- HOME -->
        <section id="home" class="section visible">
          <h2>Benvenuto nel Portale Interno</h2>
          <p class="subtitle">
            Qui trovi tutte le <strong>procedure</strong> e le <strong>comunicazioni interne</strong>
            della Farmacia Montesano.
          </p>

          <div class="cards-grid">
            <div class="card">
              <h3>üìÑ Procedure cassa</h3>
              <p>
                Anticipi, ticket, scontrini, gestione POS, sotto cassa‚Ä¶
                Tutto in un unico posto, sempre aggiornato.
              </p>
            </div>

            <div class="card">
              <h3>üì£ Comunicazioni veloci</h3>
              <p>
                Note importanti di giornata: errori da evitare, nuove promo,
                consegne in arrivo, turni extra, ecc.
              </p>
            </div>

            <div class="card">
              <h3>‚úÖ Formazione</h3>
              <p>
                In futuro possiamo aggiungere quiz veloci per verificare che
                tutti abbiano letto e compreso le procedure.
              </p>
            </div>
          </div>
        </section>

        <!-- PROCEDURE -->
        <section id="procedures" class="section">
          <h2>Procedure interne</h2>
          <div id="procedure-list" class="list"></div>
        </section>

        <!-- COMUNICAZIONI -->
        <section id="messages" class="section">
          <h2>Comunicazioni interne</h2>
          <div id="message-list" class="list"></div>
        </section>
      </main>
    </div>
  </div>

  <!-- JAVASCRIPT INLINE -->
  <script>
    function showRegister() {
      document.getElementById("login-box").style.display = "none";
      document.getElementById("register-box").style.display = "block";
      hideAuthError();
    }

    function showLogin() {
      document.getElementById("login-box").style.display = "block";
      document.getElementById("register-box").style.display = "none";
      hideAuthError();
    }

    function showAuthError(msg) {
      const el = document.getElementById("auth-error");
      el.textContent = msg;
      el.style.display = "block";
    }

    function hideAuthError() {
      const el = document.getElementById("auth-error");
      el.textContent = "";
      el.style.display = "none";
    }

    function register() {
      const name = document.getElementById("reg-name").value.trim();
      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value;

      if (!name || !email || !password) {
        showAuthError("Compila tutti i campi.");
        return;
      }

      let users = JSON.parse(localStorage.getItem("dipendenti") || "[]");

      if (users.find((u) => u.email === email)) {
        showAuthError("Questa email √® gi√† registrata.");
        return;
      }

      users.push({ name, email, password });
      localStorage.setItem("dipendenti", JSON.stringify(users));

      alert("Registrazione completata! Ora effettua il login.");
      showLogin();
      document.getElementById("reg-password").value = "";
    }

    function login() {
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;

      let users = JSON.parse(localStorage.getItem("dipendenti") || "[]");
      const user = users.find(
        (u) => u.email === email && u.password === password
      );

      if (!user) {
        showAuthError("Email o password non corretti.");
        return;
      }

      localStorage.setItem("utenteAttivo", JSON.stringify(user));
      initPortal(user);
    }

    function logout() {
      localStorage.removeItem("utenteAttivo");
      document.getElementById("portal").classList.add("hidden");
      document.getElementById("auth-screen").classList.remove("hidden");
      document.getElementById("login-email").value = "";
      document.getElementById("login-password").value = "";
    }

    function initPortal(user) {
      document.getElementById("auth-screen").classList.add("hidden");
      document.getElementById("portal").classList.remove("hidden");

      document.getElementById("user-name-display").textContent =
        user.name || user.email;

      loadProcedures();
      loadMessages();

      activateNavButton(document.getElementById("nav-home"));
      showOnlySection("home");
    }

    function showSection(sectionId, btn) {
      showOnlySection(sectionId);
      activateNavButton(btn);
    }

    function showOnlySection(sectionId) {
      document
        .querySelectorAll(".section")
        .forEach((sec) => sec.classList.remove("visible"));
      document.getElementById(sectionId).classList.add("visible");
    }

    function activateNavButton(btn) {
      document
        .querySelectorAll(".nav-btn")
        .forEach((b) => b.classList.remove("active"));
      if (btn) btn.classList.add("active");
    }

    function loadProcedures() {
      const procedures = [
        {
          title: "Anticipi ‚Äì i clienti pagano subito",
          important: true,
          meta: "Cassa / Ricette SSN",
          text:
            "Il cliente paga subito l'importo del farmaco. Quando porta la ricetta, si emette il ticket e si restituisce l'eventuale differenza dalla scatoletta sotto cassa."
        },
        {
          title: "Scontrino POS ‚Äì niente vendite manuali",
          important: true,
          meta: "POS / Gestionale",
          text:
            "Le vendite con carta vanno sempre fatte partendo dal gestionale collegato al POS. Evitare lo scontrino manuale sul POS, salvo emergenze."
        },
        {
          title: "Sotto cassa ‚Äì gestione contanti",
          important: false,
          meta: "Cassa",
          text:
            "Eventuali anticipi o differenze da restituire vanno sempre messi nella scatoletta sotto cassa, con bigliettino di riferimento se necessario."
        },
        {
          title: "Codice fiscale obbligatorio",
          important: false,
          meta: "Ticket / Detrazione",
          text:
            "Per le spese detraibili, controllare sempre il codice fiscale del cliente prima di chiudere lo scontrino."
        }
      ];

      const container = document.getElementById("procedure-list");
      container.innerHTML = "";

      procedures.forEach((p) => {
        const div = document.createElement("div");
        div.className = "list-item";

        const titleRow = document.createElement("div");
        titleRow.className = "list-item-title";

        if (p.important) {
          const badge = document.createElement("span");
          badge.className = "badge-important";
          badge.textContent = "IMPORTANTE";
          titleRow.appendChild(badge);
        }

        const spanTitle = document.createElement("span");
        spanTitle.textContent = p.title;
        titleRow.appendChild(spanTitle);

        const meta = document.createElement("div");
        meta.className = "list-item-meta";
        meta.textContent = p.meta;

        const text = document.createElement("div");
        text.textContent = p.text;

        div.appendChild(titleRow);
        div.appendChild(meta);
        div.appendChild(text);

        container.appendChild(div);
      });
    }

    function loadMessages() {
      const messages = [
        {
          title: "Controllare incassi turno mattina",
          when: "Oggi",
          text:
            "Al cambio turno verificare che il contante in cassa coincida con il totale gestionale."
        },
        {
          title: "Arrivato ordine Uriage",
          when: "Ieri",
          text:
            "Controllare i colli e sistemare i prodotti in esposizione promo vicino alla vetrina."
        },
        {
          title: "Nuove regole anticipi ASL",
          when: "Questa settimana",
          text:
            "Le nuove procedure sono caricate nella sezione 'Procedure interne'. Tutti i collaboratori devono leggerle."
        },
        {
          title: "POS lento ‚Äì riavviare prima di chiamare assistenza",
          when: "Nota fissa",
          text:
            "Se il POS non comunica con il gestionale, riavviare prima il POS, poi il PC, e solo dopo contattare l'assistenza."
        }
      ];

      const container = document.getElementById("message-list");
      container.innerHTML = "";

      messages.forEach((m) => {
        const div = document.createElement("div");
        div.className = "list-item";

        const title = document.createElement("div");
        title.className = "list-item-title";
        title.textContent = m.title;

        const meta = document.createElement("div");
        meta.className = "list-item-meta";
        meta.textContent = m.when;

        const text = document.createElement("div");
        text.textContent = m.text;

        div.appendChild(title);
        div.appendChild(meta);
        div.appendChild(text);

        container.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      const active = localStorage.getItem("utenteAttivo");
      if (active) {
        initPortal(JSON.parse(active));
      }
    });
  </script>
</body>
</html>
